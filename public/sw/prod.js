function addCDN4PicKey(t,n){const e={...t};return n.forEach((t=>{const n=e[t];n&&!n.startsWith("http")&&(e[t]="https://media.cdn.ishopastro.com/"+n)})),e}function checkLocationUrl(t){return t.includes("localhost")||t.includes("chatInbox")}function send_message_to_all_clients(t){clients.matchAll().then((n=>{n.forEach((n=>{send_message_to_client(n,t).then((t=>console.log("webPush Received Message: ",t)))}))}))}function send_message_to_client(t,n){return new Promise((function(e,o){var i=new MessageChannel;i.port1.onmessage=function(t){t.data.error?o(t.data.error):e(t.data)},t.postMessage(n,[i.port2])}))}self.addEventListener("push",(t=>{const n=t.data.json();console.log(t,t.data.json()),t.waitUntil(clients.matchAll({includeUncontrolled:!0,type:"window"}).then((t=>{let e=!0;for(const n of t)console.log(n),checkLocationUrl(n.url)&&"visible"===n.visibilityState&&(e=!1);e&&self.registration.showNotification(n.title,addCDN4PicKey(n.options,["icon"]))})))})),self.addEventListener("pushsubscriptionchange",(t=>{const n=self.registration.pushManager.subscribe(t.oldSubscription.options).then((t=>console.log("pushsubscriptionchange==>",t.toJSON())));t.waitUntil(n)}),!1),self.addEventListener("notificationclick",(t=>{const n=t.notification.data;t.notification.close(),console.log("notification click===>",n),send_message_to_all_clients(n),t.waitUntil(clients.matchAll({includeUncontrolled:!0,type:"window"}).then((t=>{for(const n of t)if(checkLocationUrl(n.url))return n.focus();if(clients.openWindow)return clients.openWindow(n.url)})))}));